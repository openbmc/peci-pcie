{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "b4597e39_82465d98",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1000926
      },
      "writtenOn": "2023-04-06T14:36:41Z",
      "side": 1,
      "message": "If we just change it like that the current version of the `getPCIeDeviceList` would return incorrect objects.\n\n`getPCIeDeviceList` uses `getSubTreePaths` call to object mapper to get objects under the `peciPCIePath` which in our case would result to:\n\nroot@ethanolx:~# busctl call xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/object_mapper xyz.openbmc_project.ObjectMapper GetSubTreePaths sias /xyz/openbmc_project/inventory/ 1 0\nas 3 \"/xyz/openbmc_project/inventory/MyDev\" \"/xyz/openbmc_project/inventory/MyDev1\" \"/xyz/openbmc_project/inventory/system\"\n\nAs you can see the \"/xyz/openbmc_project/inventory/system\" is incorrectly returned from that call.\n\nTo fix it, we need to add \"interface\" constrain to the `getSubTreePaths` call:\n\nroot@ethanolx:~# busctl call xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/object_mapper xyz.openbmc_project.ObjectMapper GetSubTreePaths sias /xyz/openbmc_project/inventory/ 1 1 \"xyz.openbmc_project.Inventory.Item.PCIeDevice\"\nas 2 \"/xyz/openbmc_project/inventory/MyDev\" \"/xyz/openbmc_project/inventory/MyDev1\"\n\n\n\nPlease add `peciPCIePath` to the `getSubTreePaths` call inside the `getPCIeDeviceList` function.\n\nhttps://github.com/openbmc/bmcweb/blob/2ec5b14d046e287c740ef59360f3d7637efb8085/redfish-core/lib/pcie.hpp#L43",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb622e52_c75e8fbe",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1001633
      },
      "writtenOn": "2023-04-06T14:46:41Z",
      "side": 1,
      "message": "I\u0027m currently refactoring PCIe code and have dropped some commits. This is fixed in\nhttps://gerrit.openbmc.org/c/openbmc/bmcweb/+/61786\nI am still waiting for code reviews, you can review this and few commits before this.",
      "parentUuid": "b4597e39_82465d98",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f342de4a_e87733fa",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1001633
      },
      "writtenOn": "2023-04-06T14:48:40Z",
      "side": 1,
      "message": "Fixed.",
      "parentUuid": "bb622e52_c75e8fbe",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6080d74_8705028e",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1000926
      },
      "writtenOn": "2023-04-06T14:52:40Z",
      "side": 1,
      "message": "Oops, sorry, I\u0027ve accidently left a comment in the peci-pcie change, but it was meant for the bmcweb change",
      "parentUuid": "bb622e52_c75e8fbe",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2937ac2a_73588328",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1000926
      },
      "writtenOn": "2023-04-06T14:52:59Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d6080d74_8705028e",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "018cd631_815cb2cb",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2023-04-06T19:24:16Z",
      "side": 1,
      "message": "peciPCIePath isn\u0027t the inventory path. It should start with the inventory path but I think \"/xyz/openbmc_project/inventory/pcie\" if this is changed",
      "parentUuid": "2937ac2a_73588328",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50df6929_a055db4f",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1001633
      },
      "writtenOn": "2023-04-06T19:46:51Z",
      "side": 1,
      "message": "Jason, could you please help me verify the correct peciPCIePath? \nCurrently, the addPCIeDevice() function appends \"/S\u003ccpu\u003eB\u003cbus\u003eD\u003cdevice\u003e\" to peciPCIePath to create the object path for the new PCIe device. However, it\u0027s unclear if peciPCIePath is set to the correct inventory path. Can you please confirm the correct peciPCIePath value?",
      "parentUuid": "018cd631_815cb2cb",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3e93b7f_40742936",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1000276
      },
      "writtenOn": "2023-04-06T20:37:41Z",
      "side": 1,
      "message": "Yes. I can help confirm the correct path value, and I have a system to test the changes.  I will try to do that soon.",
      "parentUuid": "50df6929_a055db4f",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0bc2f71_f82d1482",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1000276
      },
      "writtenOn": "2023-04-10T21:18:27Z",
      "side": 1,
      "message": "I\u0027m not up on the latest inventory path discussion, but I trust Gunnar on that, so this path looks good to me.\n\nI tested the change on my system and confirmed that with the following minor change on the bmcweb review, this gives the same results under /redfish/v1/Systems/system/PCIeDevices as the current code:\n```\ndiff --git a/redfish-core/lib/pcie.hpp b/redfish-core/lib/pcie.hpp\nindex 7cea8409..a824bff2 100644\n--- a/redfish-core/lib/pcie.hpp\n+++ b/redfish-core/lib/pcie.hpp\n@@ -32,7 +32,7 @@ namespace redfish\n {\n\n static constexpr char const* pcieService \u003d \"xyz.openbmc_project.PCIe\";\n-static constexpr char const* pciePath \u003d \"/xyz/openbmc_project/PCIe\";\n+static constexpr char const* pciePath \u003d \"/xyz/openbmc_project/inventory/pcie\";\n static constexpr char const* pcieDeviceInterface \u003d\n     \"xyz.openbmc_project.Inventory.Item.PCIeDevice\";\n\n\n```",
      "parentUuid": "c3e93b7f_40742936",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e31288e_e08fe908",
        "filename": "include/peci_pcie.hpp",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1001633
      },
      "writtenOn": "2023-04-10T21:55:43Z",
      "side": 1,
      "message": "Hi Jason, \n\nThanks for testing.\n\nThe D-Bus object path of the subtree to search should be \"/xyz/openbmc_project/inventory\", which is the root path for all inventory objects. PCIe objects can be created in different locations within the inventory path, and the implementation-specific paths should be taken into consideration when searching for PCIe devices. \nThe code in the following commit contains all the changes needed to work with both peci-pcie and IBM implementations. Can you please test with the following commit \n\nhttps://gerrit.openbmc.org/c/openbmc/bmcweb/+/61786",
      "parentUuid": "f0bc2f71_f82d1482",
      "revId": "ffd197a114e6bc99d6dba77fec9becb7c73f244e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}